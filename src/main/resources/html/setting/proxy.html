<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      data-layout-decorate="~{layout}">
    <head>
        <title>Proxy | Local Search</title>
        <th:block layout:fragment="css">
            <link rel="stylesheet" th:href="@{/static/plugins/data-table/jquery.dataTables.min.css}"  type="text/css" />
        </th:block>
    </head>
    <body>
        <div layout:fragment="content">
            <!-- Component page -->
            <div id="blockWaiting"></div>
            <!-- Start breadcumb -->
            <div class="row bheading-title">
                <!-- Breadcrumb -->
                <div class="col-lg-9 col-sm-8 col-md-8 col-xs-12">
                    <ol class="breadcrumb">
                        <li><a th:href="@{/dashboard}" th:text="${language.get('lb_dashboard')?:'Dashboard'}"></a></li>
                        <li class="active"><span th:text="${language.get('lb_breadcrumb_manager_proxy')?:'Manager Proxy'}"></span></li>
                    </ol>
                </div>
                <!-- /Breadcrumb -->
                <div class="col-lg-3 col-md-4 col-sm-4 col-xs-12 text-right">
                    <h5 class="txt--dark" th:text="${language.get('lb_manager_proxy_page')?:'Manager Proxy'}"></h5>
                </div>
            </div>
            <!-- End breadcumb -->

            <!-- Start List Proxy Live-->
            <div class="row mt-10">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <div class="panel panel-default border-panel card-view">
                        <div class="panel-heading">
                            <div class="pull-left">
                                <h6 class="panel-title txt-dark" th:text="${language.get('lb_list_proxy_live')?:'List Proxy Live'}"></h6>
                            </div>
                            <div class="pull-right">
                                <button class="btn btn--navyblue btn--xs" data-toggle="modal" data-target="#popupProxy" th:text="${language.get('lb_button_add')?:'Add Proxy'}"></button>
                                <a th:href="@{/import-proxy}" class="btn btn--navyblue btn--xs" id="btnImport" th:text="${language.get('lb_button_import_from_database')?:'Import From Database'}"></a>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="panel-wrapper collapse in">
                            <div class="panel-body">
                                <div class="table-wrap">
                                    <th:block th:if="${listProxyLive != null && (#lists.size(listProxyLive) > 0) }">
                                        <div id="divProxyLiveWaiting">
                                            <div class="loading-page loading-box">
                                                <div class="loading-center--absolute">
                                                    <div class="object object--one"></div>
                                                    <div class="object object--two"></div>
                                                    <div class="object object--three"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <table id="tblProxyLive" class="table table-hover table-bordered display font--14" style="width:100%;">
                                            <thead>
                                                <tr>
                                                    <th th:text="${language.get('lb_table_proxy_id')?:'Proxy IP'}"></th>
                                                    <th th:text="${language.get('lb_table_proxy_port')?:'Proxy Port'}"></th>
                                                    <th>Value</th>
                                                    <th>Status Cookie</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr th:each="item : ${listProxyLive}">
                                                    <td class="tbl-truncate" th:text="${item.proxyIp}"></td>
                                                    <td th:text="${item.proxyPort}"></td>
                                                    <td th:text="${item.value}"></td>
                                                    <th:block th:switch="${item.statusCookie}">
                                                        <td th:case="EMPTY" >-</td>
                                                        <td th:case="ALIVE">Alive</td>
                                                        <td th:case="DEAD" >Dead</td>
                                                    </th:block>

                                                </tr>
                                            </tbody>
                                        </table>
                                    </th:block>
                                    <th:block th:unless="${listProxyLive != null && (#lists.size(listProxyLive) > 0) }">
                                        <!-- Show no data -->
                                        <div class="no-data text-center">
                                            <img th:src="@{/static/img/no-data.svg}"/>
                                            <span class="text-center nonecase-font block error-comment" th:text="${language.get('lb_no_data')?:'No data'}"></span> 
                                            <p class="text-center mb--10" th:text="${language.get('lb_proxy_live_empty')?:'List proxy live is empty!'}"></p>
                                        </div>
                                        <!--End No data-->
                                    </th:block>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--End List Proxy Live-->

            <!--Start List Proxy Block-->
            <div class="row mt-10">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <div class="panel panel-default border-panel card-view">
                        <div class="panel-heading">
                            <div class="pull-left">
                                <h6 class="panel-title txt-dark" th:text="${language.get('lb_list_proxy_block')?:'List Proxy Block'}"></h6>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="panel-wrapper collapse in">
                            <div class="panel-body">
                                <div class="table-wrap">
                                    <th:block th:if="${listProxyBlock != null && (#lists.size(listProxyBlock) > 0) }">
                                        <div id="divProxyBlockWaiting">
                                            <div class="loading-page loading-box">
                                                <div class="loading-center--absolute">
                                                    <div class="object object--one"></div>
                                                    <div class="object object--two"></div>
                                                    <div class="object object--three"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <table id="tblProxyBlock" class="table table-hover table-bordered display font--14" style="width:100%;">
                                            <thead>
                                                <tr>
                                                    <th th:text="${language.get('lb_table_proxy_id')?:'Proxy IP'}"></th>
                                                    <th th:text="${language.get('lb_table_proxy_port')?:'Proxy Port'}"></th>
                                                    <th>Value</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr th:each="item : ${listProxyBlock}">
                                                    <td class="tbl-truncate" th:text="${item.proxyIp}"></td>
                                                    <td th:text="${item.proxyPort}"></td>
                                                    <td th:text="${item.value}"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </th:block>
                                    <th:block th:unless="${listProxyBlock != null && (#lists.size(listProxyBlock) > 0) }">
                                        <!-- Show no data -->
                                        <div class="no-data text-center">
                                            <img th:src="@{/static/img/no-data.svg}" />
                                            <span class="text-center nonecase-font block error-comment" th:text="${language.get('lb_no_data')?:'No data'}"></span> 
                                            <p class="text-center mb--10" th:text="${language.get('lb_empty')?:'List proxy block is empty!'}"></p>
                                        </div>
                                        <!--End No data-->
                                    </th:block>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--End List Proxy Block-->
            <!--Modal Add Proxy-->
            <div id="popupProxy" class="modal fade modal-center" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form th:attr="action=@{/add-proxy}" method="post" id="frmAddNewProxy">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                                <h5 class="modal-title" id="myModalLabel" th:text="${language.get('lb_add_proxy_popup_title')?:'Add Proxy'}"></h5>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label class="control-label text-left" th:text="${language.get('lb_table_proxy_id')?:'Proxy IP'}"></label>
                                    <input type="text" name="proxyIp" class="form-control" value="" autocomplete="off"/>
                                </div>
                                <div class="form-group">
                                    <label class="control-label text-left" th:text="${language.get('lb_table_proxy_port')?:'Proxy Port'}"></label>
                                    <input type="text" name="proxyPort" class="form-control" value="" autocomplete="off"/>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <input type="submit" th:value="${language.get('lb_button_save')?:'Save'}" class="btn btn--xs btn--navyblue"/>
                                <button type="button" class="btn btn--default btn--xs" data-dismiss="modal" th:text="${language.get('lb_button_close')?:'Close'}"></button>
                            </div>
                        </form> 
                    </div>
                    <!-- /.modal-content -->
                </div>
                <!-- /.modal-dialog -->
            </div>
            <input type="hidden" id="txtSessionLanguage" th:value="${session.language}"/>
        </div>

    </body>
    <th:block layout:fragment="scripts">
        <script th:src="@{/static/plugins/data-table/jquery.dataTables.min.js}"></script>
        <script th:src="@{'/static/plugins/jquery.validate/localization/validate-' + ${session.language} + '.js'}"></script>
        <script>
            $(document).ready(function () {
                var sessionLanguage = $("#txtSessionLanguage").val().length > 0 ? $("#txtSessionLanguage").val().toLowerCase() : "ja";
                $('#tblProxyLive').DataTable({
                    "language": {
                        "url": "[(@{/static/plugins/data-table/languages/datatable-" + sessionLanguage + ".json})]"
                    },
                    "lengthMenu": [
                        [25, 50, 100, -1], [25, 50, 100, "[[${language.get('lb_select_all')?:'All'}]]"]
                    ],
                    "scrollX": true,
                    "columnDefs": [
                        {"targets": 0, "width": 150, "className": "dt-left"},
                        {"targets": 1, "width": 80, "className": "dt-left"}
                    ],
                    "initComplete": function () {
                        hideWait("#divProxyLiveWaiting");
                    }
                });

                $('#tblProxyBlock').DataTable({
                    "language": {
                        "url": "[(@{/static/plugins/data-table/languages/datatable-" + sessionLanguage + ".json})]"
                    },
                    "lengthMenu": [
                        [25, 50, 100, -1], [25, 50, 100, "[[ ${language.get('lb_select_all')?:'All'} ]]"]
                    ],
                    "scrollX": true,
                    "columnDefs": [
                        {"targets": 0, "width": 150, "className": "dt-left"},
                        {"targets": 1, "width": 80, "className": "dt-left"}
                    ],
                    "initComplete": function () {
                        hideWait("#divProxyBlockWaiting");
                    }
                });

                $("#frmAddNewProxy").validate({
                    errorElement: 'span', //default input error message container
                    errorClass: 'txt--error font--12 mt--5', // default input error message class
                    focusInvalid: false, // do not focus the last invalid input
                    rules: {
                        "proxyIp": {
                            required: true
                        },
                        "proxyPort": {
                            required: true
                        }
                    },
                    highlight: function (element) { // hightlight error inputs
                        $(element).closest('.form-group').addClass('has--error'); // set error class to the control group
                    },
                    unhighlight: function (element) { // revert the change done by hightlight
                        $(element).closest('.form-group').removeClass('has--error'); // set error class to the control group
                    },
                    success: function (label) {
                        label.closest('.form-group').removeClass('has--error'); // set success class to the control group
                    },
                    submitHandler: function () {
                        showWait("#blockWaiting");
                        e.preventDefault();
                        return true;
                    }
                });
                $('#btnImport').click(function () {
                    showWait("#blockWaiting");
                });
            });
        </script>
        <th:block th:if="${importStatus != null}">
            <script>
                showAlert("[[ ${language.get('lb_alert_success')?:'Successful!'} ]]", "[[ ${language.get('lb_import_success')?:'Imports successfully!'} ]]", "success");
            </script>
        </th:block>

    </th:block>
</html>
